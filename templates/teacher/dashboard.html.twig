{% extends 'base.html.twig' %}

{% block title %}Teacher Dashboard{% endblock %}

{% block body %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Teacher Dashboard</h1>
  <a href="{{ path('app_course_new') }}" class="btn btn-primary">+ Create Course</a>
</div>

<div class="row">
  <div class="col-md-12">
    <h2>My Courses</h2>
    {% if courses %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Course</th>
            <th>Students</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for course in courses %}
            <tr>
              <td><strong>{{ course.title }}</strong></td>
              <td>{{ course.enrollments|length }}</td>
              <td>N/A</td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <a href="{{ path('app_course_show', {id: course.id}) }}" class="btn btn-outline-primary">View</a>
                  <a href="{{ path('app_course_edit', {id: course.id}) }}" class="btn btn-outline-secondary">Edit</a>
                  <a href="{{ path('pdf_course_report', {courseId: course.id}) }}" class="btn btn-outline-success pdf-download-dash" data-course="{{ course.title }}" title="Download Course Report PDF">
                    <i class="bi bi-download"></i> Report
                  </a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="alert alert-info">You haven't created any courses yet. <a href="{{ path('app_course_new') }}">Create one now!</a></p>
    {% endif %}
  </div>
</div>

<style>
    .pdf-download-dash {
        transition: all 0.3s ease;
    }
    
    .pdf-download-dash:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const pdfButtons = document.querySelectorAll('.pdf-download-dash');
        
        pdfButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                const courseName = this.getAttribute('data-course');
                
                // Show loading state
                const originalHtml = this.innerHTML;
                this.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
                this.disabled = true;
                
                // Set timeout to restore button
                setTimeout(() => {
                    this.innerHTML = originalHtml;
                    this.disabled = false;
                    
                    // Show toast notification
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'position-fixed bottom-0 end-0 m-3 alert alert-success alert-dismissible fade show';
                    alertDiv.role = 'alert';
                    alertDiv.style.zIndex = '9999';
                    alertDiv.innerHTML = `
                        <i class="bi bi-check-circle"></i>
                        <strong>Downloading</strong> report for "${courseName}"
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    
                    document.body.appendChild(alertDiv);
                    
                    // Auto-dismiss after 5 seconds
                    setTimeout(() => {
                        if (alertDiv.parentNode) {
                            alertDiv.remove();
                        }
                    }, 5000);
                }, 1500);
            });
        });
    });
</script>
{% endblock %}
